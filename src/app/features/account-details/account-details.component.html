<a routerLink="/">Retour aux comptes</a>
<p>Compte : {{account.name}}
  <button pButton icon="pi pi-pencil" class="p-button-rounded p-button-text" routerLink="/accounts/properties/{{account._id}}" *ngIf="user.admin"></button>
</p>

<div *ngIf="subAccounts.length==0">
  Ce compte ne contient pas de sous-comptes. <a routerLink="/accounts/create" *ngIf="user.admin">Créer un sous-compte...</a>
</div>
<div *ngIf="subAccounts.length>0">
  {{subAccounts.length}} sous-compte(s)

  <p-table [value]="subAccounts">
    <ng-template pTemplate="caption">

        <a routerLink="/accounts/create" *ngIf="user.admin"><i class="pi pi-plus-circle"></i> </a>

    </ng-template>
    <ng-template pTemplate="header">
      <th>
        <td>Compte</td>
    </ng-template>
    <ng-template pTemplate="body" let-sub>
      <tr>
        <td><a routerLink="accounts/details/{{sub._id}}">{{sub.name}}</a></td>
      </tr>
    </ng-template>
  </p-table>
</div>

<p-contextMenu #cm [model]="contextMenu"></p-contextMenu>
<p-table [value]="entries" styleClass="p-datatable-striped p-datatable-gridlines" dataKey="_id" rowExpandMode="single"
  [contextMenu]="cm" [(contextMenuSelection)]="selectedEntry" *ngIf="subAccounts.length==0">
  <ng-template pTemplate="caption">
    <div class="table-header">
      Ecritures du compte
    </div>
  </ng-template>
  <ng-template pTemplate="header">
      <td width="10%">Date</td>
      <td>Référence</td>
      <td width="40%">Description</td>
      <td width="20%">Compte</td>
      <td>Débit</td>
      <td>Crédit</td>
      <td>Solde</td>
  </ng-template>
  <ng-template pTemplate="body" let-entry let-expanded="expanded">
    <tr [ngClass]="expanded ? 'rowExpanded' : ''" [pContextMenuRow]="entry">
      <td>
        <div class="p-grid p-ai-center vertical-container">
          <button type="button" pButton [pRowToggler]="entry" class="p-button-text p-button-rounded p-button-plain" [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'" style="float: left"></button>
          <span>{{entry.date | date : 'shortDate' }}</span>
        </div>
      </td>
      <td>{{entry.reference}}</td>
      <td>{{entry.transaction.description}}</td>
      <td>{{entry.contreparties.length <3 ? entry.contreparties[0].account.name : 'Transaction répartie'}}</td>
      <td class="amount"><span *ngIf="entry.debit || entry.debit != 0">  {{entry.debit | currency : 'EUR'}}</span></td>
      <td class="amount"><span *ngIf="entry.credit || entry.credit != 0">{{entry.credit | currency: 'EUR'}}</span></td>
      <td class="amount">{{entry.balance | currency: 'EUR'}}</td>
    </tr>
  </ng-template>
  <ng-template pTemplate="rowexpansion" let-entry>
    <tr>
      <td colspan="7" style="padding:0">
          <!-- contreparties -->
          <p-table [value]="entry.contreparties" dataKey="_id">
            <ng-template pTemplate="body" let-ctp>
              <tr [ngClass]="'contrepartie'">
                <td width="10%"></td>
                <td>{{ctp.reference}}</td>
                <td width="40%">{{ctp.description}}</td>
                <td width="20%">{{ctp.account.name}}</td>
                <td class="amount"><span *ngIf="ctp.debit || ctp.debit != 0">{{ctp.debit | currency: 'EUR'}}</span></td>
                <td class="amount"><span *ngIf="ctp.credit || ctp.credit != 0">{{ctp.credit | currency: 'EUR'}}</span></td>
                <td></td>
              </tr>
            </ng-template>
          </p-table>

      </td>
    </tr>
  </ng-template>
</p-table>
<p-button routerLink="/transactions/create/{{account._id}}" *ngIf="writeAllowed">Saisir une écriture</p-button>
<p-confirmDialog></p-confirmDialog>
